const async=require("async"),Table=require("easy-table"),chalk=require("chalk"),novacom=require("./novacom");
(function(){function l(b){return-1===["$","%"].indexOf(b[0])}function p(b){return b.match(/^(\d|[1-9]\d|1\d\d|2([0-4]\d|5[0-5]))\.(\d|[1-9]\d|1\d\d|2([0-4]\d|5[0-5]))\.(\d|[1-9]\d|1\d\d|2([0-4]\d|5[0-5]))\.(\d|[1-9]\d|1\d\d|2([0-4]\d|5[0-5]))$/)}function q(b){return String(b).match(/^[0-9]+$/)}function h(b,c){return c&&"function"===typeof c?b?setImmediate(c,null,b):setImmediate(c):b}function m(b,c){const g=[],e=new novacom.Resolver;async.waterfall([e.load.bind(e),e.list.bind(e),function(d,r){Array.isArray(d)&&
d.forEach(function(a){const n=a.conn.concat([]),t=a.username&&a.host&&a.port?a.username+"@"+a.host+":"+a.port:a.id,f={profile:a.profile,name:a.name,default:a.default,deviceinfo:{},connection:a.conn||["ssh"],details:{platform:a.type}};1===n.length&&-1!==n.indexOf("novacom")?(f.deviceinfo.uid=a.id,f.details.type=a.name.slice(0,3)):(f.deviceinfo={ip:a.host,port:String(a.port),user:a.username},f.details.password=a.password,f.details.privatekey=a.privateKeyName,f.details.passphrase=a.passphrase,f.details.description=
a.description);a.id&&(f.deviceinfo.uid=a.id,f.details.type=a.name.slice(0,3));g.push("full"===b?f:{name:a.name,default:a.default,info:t,connection:a.conn||"ssh",profile:a.profile})});r(g)}],function(d){h(d,c)})}const k={};"undefined"!==typeof module&&module.exports&&(module.exports=k,module.exports.isValidDeviceName=l,module.exports.isValidIpv4=p,module.exports.isValidPort=q);k.showDeviceListFull=function(b){async.waterfall([m.bind(this,"full"),function(c,g){console.log(JSON.stringify(c,null,4));
g()}],function(c){h(c,b)})};k.showDeviceList=function(b){async.waterfall([m.bind(this,"list"),function(c,g){const e=new Table;c.forEach(function(d){l(d.name)&&(e.cell("name",!0===d.default?d.name+chalk.green(" (default)"):d.name),e.cell("deviceinfo",d.info),e.cell("connection",d.connection),e.cell("profile",d.profile),e.newRow())});console.log(e.toString());g()}],function(c){h(c,b)})}})();
